<openerp>

    <!-- ******************* updating groups ******************-->
    <menuitem id="hr_payroll.menu_hr_payroll_configuration" name="Configuración"
              parent="hr_payroll.menu_hr_payroll_root" sequence="100"
              groups="hr_payroll.group_hr_payroll_user,hr_payroll.group_hr_payroll_manager"/>
    <menuitem id="hr_payroll.menu_department_tree" action="hr_payroll.action_view_hr_payslip_form"
              parent="hr_payroll.menu_hr_payroll_root"
              groups="hr_payroll.group_hr_payroll_user,hr_payroll.group_hr_payroll_manager"/>

    <!-- ************************* qweb *********************** -->
    <template id="report_payslip_custom" inherit_id="hr_payroll.report_payslip">
        <!--<xpath expr="//div[@class='header']" position="replace">
            <div class ="header">
                Your Code
            </div>
        </xpath>-->
        <xpath expr="//div[@class='page']" position="replace">
            <div class="page">
                <t t-if="'Local' in o.struct_id.name">
                    <h2>Nómina Local</h2>
                </t>
                <t t-elif="'Servicios Profesionales' in o.struct_id.name">
                    <h2>Honorarios Profesionales</h2>
                </t>
                <t t-elif="'Aguinaldo' in o.struct_id.name">
                    <h2>Recibo de Aguinaldo</h2>
                </t>
                <t t-elif="'Bono 14' in o.struct_id.name">
                    <h2>Recibo de Bono 14</h2>
                </t>
                <t t-else="">
                    <h2>Recibo</h2>
                </t>
                <p t-field="o.name"/>

                <div>
                <table class="table table-condensed table-bordered">
                    <tr>
                        <td colspan="2"><strong>Referencia</strong></td>
                        <td colspan="2"><span t-field="o.number"/></td>
                    </tr>
                </table>
                <table class="table table-condensed table-bordered">
                    <tr>
                        <td><strong>Nombre</strong></td>
                        <td><span t-field="o.employee_id"/></td>
                        <td><strong>Periodo</strong></td>
                        <td><span t-field="o.date_from" t-field-options="{'format': 'MM-yy'}"/></td>
                    </tr>
                    <tr>
                        <td><strong>DPI/PASS</strong></td>
                        <td><span t-field="o.employee_id.identification_id"/> /
                            <span t-field="o.employee_id.passport_id"/></td>
                        <td rowspan="2"><strong>Periodo de pago</strong></td>
                        <td rowspan="2"><span t-field="o.date_from" t-field-options="{'format': 'dd'}"/> al
                            <span t-field="o.date_to" t-field-options="{'format': 'dd MMMM yy'}"/></td>
                    </tr>
                    <tr>
                        <td><strong>Nit</strong></td>
                        <td><span t-field="o.employee_id.x_nit"/></td>
                    </tr>
                    <tr>
                        <td><strong>Puesto</strong></td>
                        <td><span t-field="o.employee_id.job_id"/></td>
                        <td><strong>Sueldo ordinario</strong></td>
                        <td><span t-esc="o.contract_id.wage"
                                  t-esc-options='{"widget": "monetary", "display_currency": o.contract_id.x_currency_id}'/></td>
                    </tr>
                    <tr>
                        <td><strong>Departamento</strong></td>
                        <td><span t-field="o.employee_id.department_id.name"/></td>
                        <td><strong>Forma de pago</strong></td>
                        <td>Depósito en banco</td>
                    </tr>
                </table>
            </div>

                <table class="table table-condensed">
                    <thead>
                        <tr>
                            <th>Descripción</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="o.line_ids.filtered(lambda line: line.appears_on_payslip)" t-as="line">
                            <t t-if="line.code!='BON37' and line.code!='BON'">
                                <td><span t-field="line.name"/></td>
                                <td><span t-esc="'%.2f'% line.total"/></td>
                            </t>
                        </tr>
                    </tbody>
                </table>

                <table class="table table-condensed table-bordered">
                    <tr>
                        <td><strong>Firma de recibido</strong></td>
                        <td style="min-width:200px"></td>
                        <td><strong>Fecha</strong></td>
                        <td style="min-width:100px"></td>
                    </tr>
                </table>

                <table class="table table-condensed table-bordered">
                    <tr>
                        <td>* La presente constituye constancia de retención de impuesto sobre la renta del trabajo,
                            según reglamento de impuesto sobre la renta. Acuerdo Gubernativo No. 213-2013.</td>
                    </tr>
                </table>
            </div>
        </xpath>
    </template>

    <!-- ******************* updating views ******************-->
    <!-- payslip - distance_from_holiday -->
    <record id="view_hr_payslip_form_updated" model="ir.ui.view">
        <field name="model">hr.payslip</field>
        <field name="inherit_id" ref="hr_payroll.view_hr_payslip_form"/>
        <field name="arch" type="xml">
            <!-- Cambios botones y estados -->
            <xpath expr="//button[@name='action_payslip_done']" position="before">
                <button string="Enviar a Aprobación" name="action_payslip_verify" type='object' states="draft" groups="hr_payroll.group_hr_payroll_user,hr_payroll.group_hr_payroll_manager"/>
            </xpath>
            <xpath expr="//button[@name='compute_sheet']" position="replace"/>
            <xpath expr="//button[@name='action_payslip_verify']" position="before">
                <button string="Calcular nómina" name="compute_sheet" type="object" states="draft" class="oe_highlight" groups="hr_payroll.group_hr_payroll_user,hr_payroll.group_hr_payroll_manager"/>
            </xpath>
            <xpath expr="//button[@name='action_payslip_done']" position="replace">
                <button string="Confirmar" name="action_payslip_done" type="object" states="verify" groups="hr_payroll.group_hr_payroll_user"/>
            </xpath>
            <xpath expr="//button[@name='action_payslip_cancel']" position="replace">
                <button string="Rechazar" name="action_payslip_cancel" type="object" states="verify" groups="hr_payroll.group_hr_payroll_user"/>
            </xpath>
            <xpath expr="//field[@name='state']" position="attributes"><!-- barra de estados -->
                <attribute name="statusbar_visible" eval="draft,verify,confirm,done,cancel"/><!-- confirm? -->
            </xpath>
            <!-- Cambios one2many-->
            <xpath expr="//field[@name='worked_days_line_ids']" position="replace">
                <field name="worked_days_line_ids">
                    <tree string="Worked Days" editable="bottom">
                        <field name="name"/>
                        <field name="code"/>
                        <field name="number_of_days" sum="Total Working Days"/>
                        <field name="number_of_hours"/>
                        <field name="number_of_days_calendar"/>
                        <field name="contract_id"/>
                        <field name="sequence" invisible="True"/>
                        <field name="distance_from_holiday" invisible="True"/>
                    </tree>
                    <form string="Worked Day">
                        <group col="4">
                            <field name="name"/>
                            <field name="code"/>
                            <field name="number_of_days"/>
                            <field name="number_of_hours"/>
                            <field name="number_of_days_calendar"/>
                            <field name="contract_id"/>
                            <field name="sequence"/>
                            <field name="distance_from_holiday"/>
                        </group>
                    </form>
                </field>
            </xpath>
            <xpath expr="//field[@name='line_ids']" position="replace">
                <field name="line_ids" colspan="4" nolabel="1">
                    <tree string="Salary Structure" editable="bottom" decoration-info="total == 0">
                        <field name="name"/>
                        <field name="code"/>
                        <field name="category_id"/>
                        <field name="sequence" invisible="1"/>
                        <field name="quantity" digits="(10, 0)"/>
                        <field name="rate" digits="(10, 2)"/>
                        <field name="salary_rule_id"/>
                        <field name="amount" digits="(10, 2)"/>
                        <field name="total" digits="(10, 2)"/>
                    </tree>
                    <form string="Payslip Line">
                        <group col="4">
                            <field name="name"/>
                            <field name="code"/>
                            <field name="category_id"/>
                            <field name="sequence"/>
                            <field name="quantity" digits="(10, 0)"/>
                            <field name="rate" digits="(10, 2)"/>
                            <field name="amount" digits="(10, 2)"/>
                            <field name="total" digits="(10, 2)"/>
                            <field name="salary_rule_id"/>
                        </group>
                    </form>
                </field>
            </xpath>
        </field>
    </record>

    <!-- salary rule - sequence visible -->
    <record id="hr_salary_rule_list_updated" model="ir.ui.view">
        <field name="model">hr.salary.rule</field>
        <field name="inherit_id" ref="hr_payroll.hr_salary_rule_list"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='sequence']" position="attributes">
                <attribute name="invisible" eval="0"/>
            </xpath>
        </field>
    </record>

    <!-- procesamientos de nómina - fechas creación y actualización visibles -->
    <record id="hr_payslip_run_tree_updated" model="ir.ui.view">
        <field name="model">hr.payslip.run</field>
        <field name="inherit_id" ref="hr_payroll.hr_payslip_run_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="before">
                <field name="create_date"/>
                <field name="write_date"/>
            </xpath>
        </field>
    </record>

</openerp>